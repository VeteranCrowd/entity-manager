<!DOCTYPE html><html class="default" lang="en"><head><meta charset="utf-8"/><meta http-equiv="x-ua-compatible" content="IE=edge"/><title>@karmaniverous/entity-manager</title><meta name="description" content="Documentation for @karmaniverous/entity-manager"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="stylesheet" href="assets/style.css"/><link rel="stylesheet" href="assets/highlight.css"/><script defer src="assets/main.js"></script><script async src="assets/icons.js" id="tsd-icons-script"></script><script async src="assets/search.js" id="tsd-search-script"></script><script async src="assets/navigation.js" id="tsd-nav-script"></script></head><body><script>document.documentElement.dataset.theme = localStorage.getItem("tsd-theme") || "os";document.body.style.display="none";setTimeout(() => app?app.showPage():document.body.style.removeProperty("display"),500)</script><header class="tsd-page-toolbar"><div class="tsd-toolbar-contents container"><div class="table-cell" id="tsd-search" data-base="."><div class="field"><label for="tsd-search-field" class="tsd-widget tsd-toolbar-icon search no-caption"><svg width="16" height="16" viewBox="0 0 16 16" fill="none"><use href="assets/icons.svg#icon-search"></use></svg></label><input type="text" id="tsd-search-field" aria-label="Search"/></div><div class="field"><div id="tsd-toolbar-links"></div></div><ul class="results"><li class="state loading">Preparing search index...</li><li class="state failure">The search index is not available</li></ul><a href="index.html" class="title">@karmaniverous/entity-manager</a></div><div class="table-cell" id="tsd-widgets"><a href="#" class="tsd-widget tsd-toolbar-icon menu no-caption" data-toggle="menu" aria-label="Menu"><svg width="16" height="16" viewBox="0 0 16 16" fill="none"><use href="assets/icons.svg#icon-menu"></use></svg></a></div></div></header><div class="container container-main"><div class="col-content"><div class="tsd-page-title"><h2>@karmaniverous/entity-manager</h2></div><div class="tsd-panel tsd-typography"><a id="md:entity-manager" class="tsd-anchor"></a><h1 class="tsd-anchor-link">entity-manager<a href="#md:entity-manager" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h1><p>The DynamoDB <a href="https://aws.amazon.com/blogs/compute/creating-a-single-table-design-with-amazon-dynamodb/">single-table design pattern</a> requires highly-structured key attributes that...</p>
<ul>
<li>Serve as Global Secondary Index (GSI) keys supporting entity-specific queries.</li>
<li>Support sharding across multiple partitions.</li>
</ul>
<p>Entity relationships in a traditional RDBMS are expressed in a set of Foreign Key constraints that map straightforwardly into an entity-relationship diagram (ERD). Keeping implementation and design in sync is painless, and scaling is a matter of hardware and server configuration.</p>
<p>All of this takes place at design time. At run time, database structure is more or less fixed.</p>
<p>GSIs on a NoSQL platform like DynamoDB are declared as a matter of design-time configuration. Everything ELSE happens at run time, encoded into those critical key attributes at every data write.</p>
<p>The logic to accomplish this can be both complex and fragmented across the implementation. Unlike a set of RDBMS foreign key constraints that map one-for-one to the lines in an ERD, the structure of this logic is difficult to visualize and rarely collected in one place.</p>
<p>This package shifts the implementation of DynamoDB structure &amp; scaling from logic to configuration. It features:</p>
<ul>
<li>
<p>A simple, declarative configuration format that permits articulation of every index key for every entity, all in one place.</p>
</li>
<li>
<p>A rational approach to partition sharding that can be encoded directly into table &amp; GSI hash keys and permits scaling over time.</p>
</li>
<li>
<p>High-performance decoration of entity-specific data objects with configured, shard-aware index values.</p>
</li>
<li>
<p>High-performance transformation of an entity-specific data object into a key space permitting query of related objects across all partition shards.</p>
</li>
</ul>
<a id="md:installation" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Installation<a href="#md:installation" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2><pre><code class="bash"><span class="hl-0">npm</span><span class="hl-1"> </span><span class="hl-2">install</span><span class="hl-1"> </span><span class="hl-2">@karmaniverous/entity-manager</span>
</code><button type="button">Copy</button></pre>

<a id="md:configuration" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Configuration<a href="#md:configuration" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2><p>The <code>entity-manager</code> configuration object describes each entity's structured keys and sharding strategy. For broadest compatibility, express this object as a named export from an ES6 module like this:</p>
<pre><code class="js"><span class="hl-3">// entityConfig.js</span><br/><br/><span class="hl-3">// These tagged templates are used below to simplify template literals.</span><br/><span class="hl-3">// sn2e - Template literal returns empty string if any expression is nil.</span><br/><span class="hl-3">// sn2u - Template literal returns undefined if any expression is nil.</span><br/><span class="hl-4">import</span><span class="hl-1"> { </span><span class="hl-5">sn2e</span><span class="hl-1">, </span><span class="hl-5">sn2u</span><span class="hl-1"> } </span><span class="hl-4">from</span><span class="hl-1"> </span><span class="hl-2">&#39;@karmaniverous/tagged-templates&#39;</span><span class="hl-1">;</span><br/><br/><span class="hl-3">// Entity config object named export.</span><br/><span class="hl-4">export</span><span class="hl-1"> </span><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">config</span><span class="hl-1"> = {</span><br/><span class="hl-1">  </span><span class="hl-5">entities:</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-3">// Repeat this structure for each entity type. Valid keys match /\w+/</span><br/><span class="hl-1">    </span><span class="hl-5">transaction:</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-3">// Each property of the keys object defines a structured index key for</span><br/><span class="hl-1">      </span><span class="hl-3">// this entity. Each property value is a function expects an entity</span><br/><span class="hl-1">      </span><span class="hl-3">// object as its one argument. In the examples below, entity attributes</span><br/><span class="hl-1">      </span><span class="hl-3">// are destructured in the function declaration and the return value is</span><br/><span class="hl-1">      </span><span class="hl-3">// expressed as a template literal.</span><br/><span class="hl-1">      </span><span class="hl-5">keys:</span><span class="hl-1"> {</span><br/><span class="hl-1">        </span><span class="hl-3">// Table HASH key. Note the optional shardId.</span><br/><span class="hl-1">        </span><span class="hl-0">entityPK</span><span class="hl-5">:</span><span class="hl-1"> ({ </span><span class="hl-5">shardId</span><span class="hl-1"> }) </span><span class="hl-6">=&gt;</span><span class="hl-1"> </span><span class="hl-2">`transaction</span><span class="hl-6">${</span><span class="hl-0">sn2e</span><span class="hl-2">`!</span><span class="hl-6">${</span><span class="hl-5">shardId</span><span class="hl-6">}</span><span class="hl-2">`</span><span class="hl-6">}</span><span class="hl-2">`</span><span class="hl-1">,</span><br/><br/><span class="hl-1">        </span><span class="hl-3">// Table RANGE key.</span><br/><span class="hl-1">        </span><span class="hl-0">transactionSK</span><span class="hl-5">:</span><span class="hl-1"> ({ </span><span class="hl-5">timestamp</span><span class="hl-1">, </span><span class="hl-5">transactionId</span><span class="hl-1"> }) </span><span class="hl-6">=&gt;</span><br/><span class="hl-1">          </span><span class="hl-0">sn2u</span><span class="hl-2">`timestamp#</span><span class="hl-6">${</span><span class="hl-5">timestamp</span><span class="hl-6">}</span><span class="hl-2">|transactionId#</span><span class="hl-6">${</span><span class="hl-5">transactionId</span><span class="hl-6">}</span><span class="hl-2">`</span><span class="hl-1">,</span><br/><br/><span class="hl-1">        </span><span class="hl-3">// merchants GSI HASH key. Note the optional shardId.</span><br/><span class="hl-1">        </span><span class="hl-0">merchantPK</span><span class="hl-5">:</span><span class="hl-1"> ({ </span><span class="hl-5">merchantId</span><span class="hl-1">, </span><span class="hl-5">shardId</span><span class="hl-1"> }) </span><span class="hl-6">=&gt;</span><br/><span class="hl-1">          </span><span class="hl-0">sn2u</span><span class="hl-2">`merchantId#</span><span class="hl-6">${</span><span class="hl-5">merchantId</span><span class="hl-6">}</span><span class="hl-2">|transaction</span><span class="hl-6">${</span><span class="hl-0">sn2e</span><span class="hl-2">`!</span><span class="hl-6">${</span><span class="hl-5">shardId</span><span class="hl-6">}</span><span class="hl-2">`</span><span class="hl-6">}</span><span class="hl-2">`</span><span class="hl-1">,</span><br/><br/><span class="hl-1">        </span><span class="hl-3">// merchants GSI RANGE key.</span><br/><span class="hl-1">        </span><span class="hl-0">merchantSK</span><span class="hl-5">:</span><span class="hl-1"> ({ </span><span class="hl-5">methodId</span><span class="hl-1">, </span><span class="hl-5">timestamp</span><span class="hl-1">, </span><span class="hl-5">transactionId</span><span class="hl-1"> }) </span><span class="hl-6">=&gt;</span><br/><span class="hl-1">          </span><span class="hl-0">sn2u</span><span class="hl-2">`timestamp#</span><span class="hl-6">${</span><span class="hl-5">timestamp</span><span class="hl-6">}</span><span class="hl-2">|methodId#</span><span class="hl-6">${</span><span class="hl-5">methodId</span><span class="hl-6">}</span><span class="hl-2">|transactionId#</span><span class="hl-6">${</span><span class="hl-5">transactionId</span><span class="hl-6">}</span><span class="hl-2">`</span><span class="hl-1">,</span><br/><br/><span class="hl-1">        </span><span class="hl-3">// methods GSI HASH key. Note the optional shardId.</span><br/><span class="hl-1">        </span><span class="hl-0">methodPK</span><span class="hl-5">:</span><span class="hl-1"> ({ </span><span class="hl-5">methodId</span><span class="hl-1">, </span><span class="hl-5">shardId</span><span class="hl-1"> }) </span><span class="hl-6">=&gt;</span><br/><span class="hl-1">          </span><span class="hl-0">sn2u</span><span class="hl-2">`method#</span><span class="hl-6">${</span><span class="hl-5">methodId</span><span class="hl-6">}</span><span class="hl-2">|transaction</span><span class="hl-6">${</span><span class="hl-0">sn2e</span><span class="hl-2">`!</span><span class="hl-6">${</span><span class="hl-5">shardId</span><span class="hl-6">}</span><span class="hl-2">`</span><span class="hl-6">}</span><span class="hl-2">`</span><span class="hl-1">,</span><br/><br/><span class="hl-1">        </span><span class="hl-3">// methods GSI RANGE key.</span><br/><span class="hl-1">        </span><span class="hl-0">methodSK</span><span class="hl-5">:</span><span class="hl-1"> ({ </span><span class="hl-5">merchantId</span><span class="hl-1">, </span><span class="hl-5">timestamp</span><span class="hl-1">, </span><span class="hl-5">transactionId</span><span class="hl-1"> }) </span><span class="hl-6">=&gt;</span><br/><span class="hl-1">          </span><span class="hl-0">sn2u</span><span class="hl-2">`timestamp#</span><span class="hl-6">${</span><span class="hl-5">timestamp</span><span class="hl-6">}</span><span class="hl-2">|merchantId#</span><span class="hl-6">${</span><span class="hl-5">merchantId</span><span class="hl-6">}</span><span class="hl-2">|transactionId#</span><span class="hl-6">${</span><span class="hl-5">transactionId</span><span class="hl-6">}</span><span class="hl-2">`</span><span class="hl-1">,</span><br/><br/><span class="hl-1">        </span><span class="hl-3">// users GSI HASH key. Note the optional shardId.</span><br/><span class="hl-1">        </span><span class="hl-0">userPK</span><span class="hl-5">:</span><span class="hl-1"> ({ </span><span class="hl-5">shardId</span><span class="hl-1">, </span><span class="hl-5">userId</span><span class="hl-1"> }) </span><span class="hl-6">=&gt;</span><br/><span class="hl-1">          </span><span class="hl-0">sn2u</span><span class="hl-2">`user#</span><span class="hl-6">${</span><span class="hl-5">userId</span><span class="hl-6">}</span><span class="hl-2">|transaction</span><span class="hl-6">${</span><span class="hl-0">sn2e</span><span class="hl-2">`!</span><span class="hl-6">${</span><span class="hl-5">shardId</span><span class="hl-6">}</span><span class="hl-2">`</span><span class="hl-6">}</span><span class="hl-2">`</span><span class="hl-1">,</span><br/><br/><span class="hl-1">        </span><span class="hl-3">// users GSI RANGE key.</span><br/><span class="hl-1">        </span><span class="hl-0">userSK</span><span class="hl-5">:</span><span class="hl-1"> ({ </span><span class="hl-5">merchantId</span><span class="hl-1">, </span><span class="hl-5">timestamp</span><span class="hl-1">, </span><span class="hl-5">transactionId</span><span class="hl-1"> }) </span><span class="hl-6">=&gt;</span><br/><span class="hl-1">          </span><span class="hl-0">sn2u</span><span class="hl-2">`timestamp#</span><span class="hl-6">${</span><span class="hl-5">timestamp</span><span class="hl-6">}</span><span class="hl-2">|merchantId#</span><span class="hl-6">${</span><span class="hl-5">merchantId</span><span class="hl-6">}</span><span class="hl-2">|transactionId#</span><span class="hl-6">${</span><span class="hl-5">transactionId</span><span class="hl-6">}</span><span class="hl-2">`</span><span class="hl-1">,</span><br/><span class="hl-1">      },</span><br/><br/><span class="hl-1">      </span><span class="hl-3">// The sharding configuration for this entity.</span><br/><span class="hl-1">      </span><span class="hl-5">sharding:</span><span class="hl-1"> {</span><br/><span class="hl-1">        </span><span class="hl-3">// Default number of shard key characters (0 means no shard key).</span><br/><span class="hl-1">        </span><span class="hl-5">nibbles:</span><span class="hl-1"> </span><span class="hl-8">0</span><span class="hl-1">,</span><br/><br/><span class="hl-1">        </span><span class="hl-3">// Bits represented by each shard key character, so 3 bits means an</span><br/><span class="hl-1">        </span><span class="hl-3">// octal shard key. Running with no shard key produces a single shard.</span><br/><span class="hl-1">        </span><span class="hl-3">// The first shard key character yields another 8 shards, and the second</span><br/><span class="hl-1">        </span><span class="hl-3">// yields an additional 64, for an eventual total of 73.</span><br/><span class="hl-1">        </span><span class="hl-5">nibbleBits:</span><span class="hl-1"> </span><span class="hl-8">3</span><span class="hl-1">,</span><br/><br/><span class="hl-1">        </span><span class="hl-3">// Scheduled increases in shard key length. Keys are expressed as</span><br/><span class="hl-1">        </span><span class="hl-3">// millisecond UTC timestamps. In production, these should not be</span><br/><span class="hl-1">        </span><span class="hl-3">// updated after they go into effect.</span><br/><span class="hl-1">        </span><span class="hl-5">bumps:</span><span class="hl-1"> {</span><br/><span class="hl-1">          </span><span class="hl-8">1676874972686</span><span class="hl-5">:</span><span class="hl-1"> </span><span class="hl-8">1</span><span class="hl-1">,</span><br/><span class="hl-1">          </span><span class="hl-8">1708411134487</span><span class="hl-5">:</span><span class="hl-1"> </span><span class="hl-8">2</span><span class="hl-1">,</span><br/><span class="hl-1">        },</span><br/><br/><span class="hl-1">        </span><span class="hl-3">// Extracts entity key to be hashed for shard key.</span><br/><span class="hl-1">        </span><span class="hl-0">entityKey</span><span class="hl-5">:</span><span class="hl-1"> ({ </span><span class="hl-5">transactionId</span><span class="hl-1"> }) </span><span class="hl-6">=&gt;</span><span class="hl-1"> </span><span class="hl-5">transactionId</span><span class="hl-1">,</span><br/><br/><span class="hl-1">        </span><span class="hl-3">// Extracts timestamp to determine shard key length.</span><br/><span class="hl-1">        </span><span class="hl-0">timestamp</span><span class="hl-5">:</span><span class="hl-1"> ({ </span><span class="hl-5">timestamp</span><span class="hl-1"> }) </span><span class="hl-6">=&gt;</span><span class="hl-1"> </span><span class="hl-5">timestamp</span><span class="hl-1">,</span><br/><span class="hl-1">      },</span><br/><span class="hl-1">    },</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">  </span><span class="hl-3">// Will be added to every entity object as appropriate. Pick a value that</span><br/><span class="hl-1">  </span><span class="hl-3">// won&#39;t collide with entity data!</span><br/><span class="hl-1">  </span><span class="hl-5">shardKeyToken:</span><span class="hl-1"> </span><span class="hl-2">&#39;shardId&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">};</span>
</code><button type="button">Copy</button></pre>

<a id="md:usage" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Usage<a href="#md:usage" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2><pre><code class="js"><span class="hl-3">// Import an optional logger.</span><br/><span class="hl-4">import</span><span class="hl-1"> { </span><span class="hl-5">Logger</span><span class="hl-1"> } </span><span class="hl-4">from</span><span class="hl-1"> </span><span class="hl-2">&#39;@karmaniverous/edge-logger&#39;</span><span class="hl-1">;</span><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">logger</span><span class="hl-1"> = </span><span class="hl-6">new</span><span class="hl-1"> </span><span class="hl-0">Logger</span><span class="hl-1">(</span><span class="hl-2">&#39;debug&#39;</span><span class="hl-1">);</span><br/><br/><span class="hl-3">// Import EntityManager &amp; config object.</span><br/><span class="hl-4">import</span><span class="hl-1"> { </span><span class="hl-5">EntityManager</span><span class="hl-1"> } </span><span class="hl-4">from</span><span class="hl-1"> </span><span class="hl-2">&#39;@karmaniverous/entity-manager&#39;</span><span class="hl-1">;</span><br/><span class="hl-4">import</span><span class="hl-1"> { </span><span class="hl-5">config</span><span class="hl-1"> } </span><span class="hl-4">from</span><span class="hl-1"> </span><span class="hl-2">&#39;./entityConfig.js&#39;</span><span class="hl-1">;</span><br/><br/><span class="hl-3">// Create &amp; configure an EntityManager (logger defaults to console object).</span><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">entityManager</span><span class="hl-1"> = </span><span class="hl-6">new</span><span class="hl-1"> </span><span class="hl-0">EntityManager</span><span class="hl-1">({ </span><span class="hl-5">config</span><span class="hl-1">, </span><span class="hl-5">logger</span><span class="hl-1"> });</span><br/><br/><span class="hl-3">// Define a transaction object.</span><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">transaction</span><span class="hl-1"> = {</span><br/><span class="hl-1">  </span><span class="hl-5">methodId:</span><span class="hl-1"> </span><span class="hl-2">&#39;methodIdValue&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">merchantId:</span><span class="hl-1"> </span><span class="hl-2">&#39;merchantIdValue&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">timestamp:</span><span class="hl-1"> </span><span class="hl-8">1676869312851</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">transactionId:</span><span class="hl-1"> </span><span class="hl-2">&#39;transactionIdValue&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">userId:</span><span class="hl-1"> </span><span class="hl-2">&#39;userIdValue&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">};</span><br/><br/><span class="hl-3">// Transform the transaction for posting to the database.</span><br/><span class="hl-5">entityManager</span><span class="hl-1">.</span><span class="hl-0">addKeys</span><span class="hl-1">(</span><span class="hl-5">transaction</span><span class="hl-1">);</span><br/><br/><span class="hl-3">// debug:    adding sharded index keys to transaction...</span><br/><span class="hl-3">// debug:    {</span><br/><span class="hl-3">// debug:      &quot;methodId&quot;: &quot;methodIdValue&quot;,</span><br/><span class="hl-3">// debug:      &quot;merchantId&quot;: &quot;merchantIdValue&quot;,</span><br/><span class="hl-3">// debug:      &quot;timestamp&quot;: 1676869312851,</span><br/><span class="hl-3">// debug:      &quot;transactionId&quot;: &quot;transactionIdValue&quot;,</span><br/><span class="hl-3">// debug:      &quot;userId&quot;: &quot;userIdValue&quot;</span><br/><span class="hl-3">// debug:    }</span><br/><span class="hl-3">// debug:    generated shard key &#39;7&#39; for transaction id &#39;transactionIdValue&#39; at timestamp 1676869312851.</span><br/><span class="hl-3">// debug:</span><br/><span class="hl-3">// debug:    done</span><br/><span class="hl-3">// debug:    {</span><br/><span class="hl-3">// debug:      &quot;methodId&quot;: &quot;methodIdValue&quot;,</span><br/><span class="hl-3">// debug:      &quot;merchantId&quot;: &quot;merchantIdValue&quot;,</span><br/><span class="hl-3">// debug:      &quot;timestamp&quot;: 1676869312851,</span><br/><span class="hl-3">// debug:      &quot;transactionId&quot;: &quot;transactionIdValue&quot;,</span><br/><span class="hl-3">// debug:      &quot;userId&quot;: &quot;userIdValue&quot;,</span><br/><span class="hl-3">// debug:      &quot;shardId&quot;: &quot;7&quot;,</span><br/><span class="hl-3">// debug:      &quot;entityPK&quot;: &quot;transaction!7&quot;,</span><br/><span class="hl-3">// debug:      &quot;transactionSK&quot;: &quot;timestamp#1676869312851|transactionId#transactionIdValue&quot;,</span><br/><span class="hl-3">// debug:      &quot;merchantPK&quot;: &quot;merchantId#merchantIdValue|transaction!7&quot;,</span><br/><span class="hl-3">// debug:      &quot;merchantSK&quot;: &quot;timestamp#1676869312851|methodId#methodIdValue|transactionId#transactionIdValue&quot;,</span><br/><span class="hl-3">// debug:      &quot;methodPK&quot;: &quot;method#methodIdValue|transaction!7&quot;,</span><br/><span class="hl-3">// debug:      &quot;methodSK&quot;: &quot;timestamp#1676869312851|merchantId#merchantIdValue|transactionId#transactionIdValue&quot;,</span><br/><span class="hl-3">// debug:      &quot;userPK&quot;: &quot;user#userIdValue|transaction!7&quot;,</span><br/><span class="hl-3">// debug:      &quot;userSK&quot;: &quot;timestamp#1676869312851|merchantId#merchantIdValue|transactionId#transactionIdValue&quot;</span><br/><span class="hl-3">// debug:    }</span><br/><br/><span class="hl-3">// Extract key space for querying across shards by related entity.</span><br/><span class="hl-5">entityManager</span><span class="hl-1">.</span><span class="hl-0">getKeySpace</span><span class="hl-1">(</span><span class="hl-2">&#39;transaction&#39;</span><span class="hl-1">, </span><span class="hl-5">transaction</span><span class="hl-1">, </span><span class="hl-2">&#39;userPK&#39;</span><span class="hl-1">, </span><span class="hl-8">1686874972686</span><span class="hl-1">);</span><br/><br/><span class="hl-3">// debug:    getting shard key space for transaction on key &#39;userPK&#39; at timestamp 1686874972686...</span><br/><span class="hl-3">// debug:    {</span><br/><span class="hl-3">// debug:      &quot;methodId&quot;: &quot;methodIdValue&quot;,</span><br/><span class="hl-3">// debug:      &quot;merchantId&quot;: &quot;merchantIdValue&quot;,</span><br/><span class="hl-3">// debug:      &quot;timestamp&quot;: 1676876779118,</span><br/><span class="hl-3">// debug:      &quot;transactionId&quot;: &quot;transactionIdValue&quot;,</span><br/><span class="hl-3">// debug:      &quot;userId&quot;: &quot;userIdValue&quot;</span><br/><span class="hl-3">// debug:    }</span><br/><span class="hl-3">// debug:</span><br/><span class="hl-3">// debug:    done</span><br/><span class="hl-3">// debug:    [</span><br/><span class="hl-3">// debug:      &quot;user#userIdValue|transaction&quot;,</span><br/><span class="hl-3">// debug:      &quot;user#userIdValue|transaction!0&quot;,</span><br/><span class="hl-3">// debug:      &quot;user#userIdValue|transaction!1&quot;,</span><br/><span class="hl-3">// debug:      &quot;user#userIdValue|transaction!2&quot;,</span><br/><span class="hl-3">// debug:      &quot;user#userIdValue|transaction!3&quot;,</span><br/><span class="hl-3">// debug:      &quot;user#userIdValue|transaction!4&quot;,</span><br/><span class="hl-3">// debug:      &quot;user#userIdValue|transaction!5&quot;,</span><br/><span class="hl-3">// debug:      &quot;user#userIdValue|transaction!6&quot;,</span><br/><span class="hl-3">// debug:      &quot;user#userIdValue|transaction!7&quot;</span><br/><span class="hl-3">// debug:    ]</span>
</code><button type="button">Copy</button></pre>

<p>See <a href="https://github.com/karmaniverous/entity-manager/blob/main/lib/EntityManager/EntityManager.test.js">unit tests</a> for more usage examples.</p>
<a id="md:future-proofing" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Future-Proofing<a href="#md:future-proofing" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2><p>The current design provides for scaling via planned increases in shard key length. The number of shards per key character does not need to be decided until shard keys are first applied.</p>
<p>This design assumes that currently-defined key structures will remain stable across the life of the database, meaning new ones could be layered on but existing ones should not be changed once in use.</p>
<p>The same technique that provides for shard key length bumps could also be applied to such schema changes, permitting unified query across schema changes in the same manner as the package currently supports unified query across shards.</p>
<p>This change can be accomplished with no breaking changes to existing implementations.</p>
<hr>
<p>Built for you with ❤️ on Bali! Find more great tools &amp; templates on <a href="https://github.com/karmaniverous">my GitHub Profile</a>.</p>
</div></div><div class="col-sidebar"><div class="page-menu"><div class="tsd-navigation settings"><details class="tsd-accordion"><summary class="tsd-accordion-summary"><h3><svg width="20" height="20" viewBox="0 0 24 24" fill="none"><use href="assets/icons.svg#icon-chevronDown"></use></svg>Settings</h3></summary><div class="tsd-accordion-details"><div class="tsd-filter-visibility"><span class="settings-label">Member Visibility</span><ul id="tsd-filter-options"><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-protected" name="protected"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Protected</span></label></li><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-inherited" name="inherited" checked/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Inherited</span></label></li><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-external" name="external"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>External</span></label></li></ul></div><div class="tsd-theme-toggle"><label class="settings-label" for="tsd-theme">Theme</label><select id="tsd-theme"><option value="os">OS</option><option value="light">Light</option><option value="dark">Dark</option></select></div></div></details></div><details open class="tsd-accordion tsd-page-navigation"><summary class="tsd-accordion-summary"><h3><svg width="20" height="20" viewBox="0 0 24 24" fill="none"><use href="assets/icons.svg#icon-chevronDown"></use></svg>On This Page</h3></summary><div class="tsd-accordion-details"><a href="#md:entity-manager"><span>entity-<wbr/>manager</span></a><ul><li><a href="#md:installation"><span>Installation</span></a></li><li><a href="#md:configuration"><span>Configuration</span></a></li><li><a href="#md:usage"><span>Usage</span></a></li><li><a href="#md:future-proofing"><span>Future-<wbr/>Proofing</span></a></li></ul></div></details></div><div class="site-menu"><nav id="tsd-sidebar-links" class="tsd-navigation"><a href="https://github.com/karmaniverous/entity-manager">GitHub Repo</a></nav><nav class="tsd-navigation"><a href="modules.html" class="current"><svg class="tsd-kind-icon" viewBox="0 0 24 24"><use href="assets/icons.svg#icon-1"></use></svg><span>@karmaniverous/entity-manager</span></a><ul class="tsd-small-nested-navigation" id="tsd-nav-container" data-base="."><li>Loading...</li></ul></nav></div></div></div><footer><p class="tsd-generator">Generated using <a href="https://typedoc.org/" target="_blank">TypeDoc</a></p></footer><div class="overlay"></div></body></html>
